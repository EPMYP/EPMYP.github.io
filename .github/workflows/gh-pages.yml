# 工作流名称
name: GitHub Pages Build and Deployment

# 触发条件：推送到master分支时自动运行（主分支为master）
on:
  push:
    branches: [ master ]

# 工作流任务
jobs:
  # 构建和部署任务
  build-and-deploy:
    # 运行环境：最新版Ubuntu
    runs-on: ubuntu-latest
    
    # 任务步骤
    steps:
      # 步骤1：检出代码
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # 深度1，只获取最新提交，加快速度
          fetch-depth: 1
          
      # 步骤2：设置Node.js环境
      - name: Set Up Node.js
        uses: actions/setup-node@v4
        with:
          # 指定Node.js版本（兼容Vue 3的稳定版本）
          node-version: '20'
          # 缓存npm依赖，加快安装速度
          cache: 'npm'
          
      # 步骤3：安装依赖
      - name: Install Dependencies
        run: npm ci
        # npm ci 比 npm install 更快，且严格按照package-lock.json安装
        
      # 步骤4：构建项目
      - name: Build Project
        run: npm run build
        # 构建环境变量，指定基础路径（与vite.config.ts一致）
        env:
          NODE_ENV: production
          VITE_BASE_PATH: '/EPMYP.github.io/'  # 替换为你的GitHub仓库名称
        
      # 步骤5：部署到GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 部署的目录（Vite构建输出目录）
          publish_dir: ./dist
          # 部署到gh-pages分支
          publish_branch: gh-pages
          # 提交信息
          commit_message: 'auto-deploy: ${{ github.sha }}'
          # GitHub令牌（自动生成，无需修改）
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 强制推送（覆盖历史提交，减少分支体积）
          force_orphan: true
